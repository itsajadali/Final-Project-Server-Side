const catchAsync = require("express-async-handler");
const tf = require("@tensorflow/tfjs");

const array = [
  [
    [-1.44722974, 0.388623208],
    [-1.4583993, -0.00197400851],
    [-1.59488618, 0.095248878],
    [-1.6529566, -0.0130608268],
    [-1.61896873, 0.337453306],
    [-1.08788455, 0.0184939653],
    [-0.693674505, 0.797982812],
    [-0.641826034, 0.246200189],
    [-0.42159301, -0.154631019],
    [-0.516661704, 0.385211885],
    [-1.09889603, 0.184796304],
    [-1.49508405, 0.223173708],
    [-1.54330277, 0.0850148723],
    [-1.32104588, 0.02190529],
    [-0.956541538, 0.105482846],
    [-1.18938935, 0.0517544225],
    [-1.02819026, 0.117422514],
    [-0.945241928, -0.087257266],
    [-0.623218656, 0.106335692],
    [0.875067413, 0.535310388],
    [0.616605103, 1.52033174],
    [0.0846388564, -0.10090258],
    [0.301079035, -0.169129163],
    [0.715145469, -0.204095304],
    [0.762454212, -0.095785588],
    [0.389772773, -0.0761704445],
    [0.333902031, -0.192155644],
    [0.408895105, -0.251853913],
    [0.254076153, 0.0312864445],
    [0.438684851, -0.0284118168],
    [0.645469546, -0.230533108],
    [0.55941397, -0.170834839],
    [0.236080453, -0.0011211934],
    [-0.0496737175, -0.0147664882],
    [0.149127632, 0.0372562818],
    [0.394717753, 0.011671287],
    [0.23768121, -0.100049749],
    [-0.0203555096, 0.51740092],
    [-1.30994773, 0.134479165],
    [-1.77313781, 0.0653997511],
    [-1.08697712, 0.174562261],
    [0.540714741, -0.33372581],
    [0.32112664, 0.0432261117],
    [0.305458128, -0.301318198],
    [0.00788955763, -0.0241476465],
    [0.182358474, 0.0491959117],
    [0.331332684, -0.0949327573],
    [0.378238708, -0.178510323],
    [0.697524488, -0.169129163],
    [0.505381048, -0.346518308],
    [0.0997363701, -0.244178414],
    [-0.892858207, 0.0150826424],
    [-0.685395539, 0.188207626],
    [-0.176377594, 1.53056574],
    [0.394223273, -0.164865002],
    [-0.98948437, 0.784337401],
    [-1.13916969, 0.546397209],
    [-1.07385755, -0.0599666089],
    [-1.0849278, -0.0821402818],
    [-1.13458407, -0.0702006146],
    [-1.0751754, -0.0889629275],
    [-1.04705775, -0.108578071],
    [-1.05473518, -0.0923742503],
    [-1.19022286, -0.0684949532],
    [-1.14896786, -0.0846987589],
    [-1.29186022, -0.0352344923],
    [-1.31667435, 0.011671287],
    [-0.564816833, 0.0892790407],
    [0.00505765341, 0.101218708],
    [0.29801771, -0.233944431],
    [-0.588234067, 0.154094324],
    [-1.91416681, 0.0517544225],
    [-1.46502411, 0.155799985],
    [-0.800504208, 0.0304335989],
    [-0.717474222, 0.0509016067],
    [-0.463518381, -0.0676421076],
    [-0.263796866, -0.129046053],
    [-0.0749925599, -0.0804345831],
    [-0.367560118, 0.0236109514],
    [-0.233736932, -0.0147664882],
    [-0.591914833, -0.10772524],
    [-0.560978055, -0.0932270959],
    [-0.582075775, -0.124781892],
    [-0.373226464, -0.262087911],
    [-0.559986472, -0.118812062],
    [-0.413069338, 0.0261694603],
    [-0.328481942, 0.00229013059],
    [-0.704130411, 0.0449317731],
    [-0.449236572, 0.0210524425],
    [-0.76126802, 0.0474902503],
    [-0.772169948, 0.0184939653],
    [-0.848738194, 0.148124486],
    [-1.09105539, -0.0437628031],
    [-1.02837646, -0.0736119375],
    [-1.00732708, -0.0864044204],
    [-0.885086358, -0.0829930976],
    [-0.948099375, -0.071906276],
    [-0.931357682, 0.252170056],
    [-0.453534126, 0.0602827631],
    [-0.518782496, -0.0267061554],
    [-0.841761649, -0.0667892918],
    [-0.868574262, -0.0412042961],
    [-0.0924810022, -0.206653789],
    [0.18499665, -0.0795817673],
    [-0.748928487, 0.209528416],
    [-1.28842938, -0.0215891693],
    [-1.31878245, -0.0113551645],
    [-1.32099497, 0.0295807831],
    [-1.31896091, 0.133626312],
    [-1.29640496, 0.0346977711],
    [-1.3707124, 0.0338449553],
    [-1.37573397, 0.00655430136],
    [-1.33080077, 0.0253166128],
    [-1.26836896, 0.00143731537],
    [-1.22936213, -0.0207363218],
    [-1.19710004, 0.0440789275],
    [-1.22907674, 0.274343699],
    [-1.28115964, -0.00538533228],
    [-1.25116599, 0.147271648],
    [-1.02137947, 0.102924369],
    [-1.02448153, 0.097807385],
    [-1.03933954, 0.0636940897],
    [-1.06209409, 0.113158345],
    [-1.04651487, 0.00229013059],
    [-1.02578413, -0.027559001],
    [-0.997146487, 0.0594299175],
    [-1.01874387, 0.0415204503],
    [-1.05242074, 0.0150826424],
    [-1.03889596, -0.0522911139],
    [-1.00409758, -0.0821402818],
    [-0.992456436, -0.0309703257],
    [-1.2737906, 0.129362181],
    [-1.13899124, 0.0304335989],
    [-0.998015702, -0.0105023496],
    [-1.1123215, 0.0713695809],
    [-0.958815217, -0.0250004921],
    [-0.804212928, 0.302487135],
    [0.69294399, 0.00314297737],
    [1.11009467, -0.297054052],
    [0.637453079, -0.348223954],
    [0.601257741, -0.361016452],
    [0.312498391, 0.37583077],
    [-1.08766782, -0.125634715],
    [-1.08031154, -0.128193215],
    [-0.909745038, -0.160600856],
    [0.38068825, -0.193008482],
    [-0.611490905, 0.0645469055],
    [0.287401289, -0.146955535],
    [-0.227650002, 0.141301811],
    [-0.609775364, 0.190766096],
    [-0.658190489, 0.174562261],
    [-0.752147794, 0.0159354582],
    [-0.607305527, 0.0756337196],
    [-0.603155673, -0.131604537],
    [-0.585527122, -0.176804662],
    [-0.502961099, -0.0574081317],
    [-0.250083447, 0.140449002],
    [-0.208871782, -0.174246162],
    [-0.294338554, -0.192155644],
    [-0.354736239, -0.0582609437],
    [-0.475386381, -0.187038645],
    [-0.476400882, -0.0761704445],
    [-0.605327427, -0.0864044204],
    [-0.583954334, -0.15633668],
    [-0.730410218, -0.0386458188],
    [-0.572958112, -0.0915214345],
    [-0.471504301, -0.134163052],
    [-0.784412503, 0.102071524],
    [-1.16928816, -0.000268346485],
    [-0.821517766, 0.0918375552],
    [-0.603619635, 0.170298129],
    [-0.227599055, -0.139280036],
    [-0.0179645922, -0.148661196],
    [-0.761494875, 0.275196552],
    [-0.923478901, 0.109747015],
    [-0.530015767, -0.12307623],
    [-0.523541391, -0.172540501],
    [-0.499191135, -0.175951824],
    [-0.505828679, -0.164012179],
    [0.467674226, -0.0522911139],
    [1.24374449, -0.0446156487],
    [-0.371011376, 0.18394345],
    [-0.301926851, -0.0232944831],
    [0.014369024, -0.0616722703],
    [-0.131031528, -0.0761704445],
    [0.723090589, -0.146955535],
    [0.437971115, -0.0011211934],
    [-0.240145028, -0.0463213138],
    [-0.217112616, -0.129898876],
    [-0.101537466, -0.121370554],
    [0.0925406441, -0.203242466],
    [-0.976922989, 0.163475484],
    [1.55295932, 0.123392344],
    [1.64897358, -0.274880379],
    [2.05091739, -0.300465375],
    [-0.500883639, 1.28665578],
    [-1.25858355, 1.15446663],
    [-1.55588698, 0.640208781],
    [-1.40279377, 0.0730752423],
    [-1.22902322, 0.0364034325],
    [-1.28066778, 0.124245159],
    [-1.14776731, 0.0943960324],
    [-1.10831189, 0.101218708],
    [-1.03798604, 2.44053817],
    [-0.828282714, 0.675174952],
    [-0.792158842, -0.0778761059],
    [-0.663086951, -0.139280036],
    [-0.795482755, 0.121686682],
    [-0.736428261, 0.108041354],
    [-0.690149367, 0.151535809],
    [-0.675829232, -0.0224419832],
    [-0.50034076, 0.113158345],
    [-0.791944742, 0.31442681],
    [-0.909199655, 0.108041354],
    [-0.823044598, 0.097807385],
    [-0.692993999, -0.0113551645],
    [-0.496616691, -0.0650836229],
    [-0.840714037, 0.082456395],
    [-0.773640633, -0.11369507],
    [-0.525738597, 0.0619884245],
    [-0.783321619, 0.00314297737],
    [-0.731465518, 0.0304335989],
    [-0.539755344, 0.0568714067],
    [-0.477575928, -0.10687241],
    [-0.570200145, -0.108578071],
    [0.175619021, 0.168592468],
    [0.486223012, -0.0659364387],
    [0.696290791, 0.0969545394],
    [-0.815170944, -0.0864044204],
    [-0.417682946, -0.0113551645],
    [-0.366650134, 0.130214989],
    [-1.20427275, 0.150682971],
    [-0.879330814, 0.0850148723],
    [-0.403508127, 0.131067842],
    [-0.602210104, 0.589891732],
    [-0.351458281, -0.266352057],
    [-0.344966084, -0.290231377],
    [-0.363104492, -0.195566967],
    [-0.464402884, 0.808216751],
    [0.203249782, 0.670910776],
    [-0.670496821, 0.779220462],
    [0.209856704, 2.93091679],
    [-0.464255035, 1.10329676],
    [0.0284673329, 2.03117824],
    [-0.334884942, 0.756193995],
    [0.257810354, 1.29262555],
    [0.908548176, 0.51995939],
    [0.782224, 0.537868917],
    [0.665099144, -0.071906276],
    [0.0748355389, -0.140985698],
    [0.00488430727, -0.0505854525],
    [0.532364368, 0.166033953],
    [0.834174454, 0.448321491],
    [0.44883737, 0.305045694],
    [0.186202317, -0.274880379],
    [0.254438072, 0.566012383],
    [0.409394711, 1.98512542],
    [-0.259037971, 0.386917591],
    [-0.890413702, 0.676880538],
    [-0.768667579, 0.240230396],
    [-0.970718801, 0.444910169],
    [-1.03863847, 0.253875673],
    [-0.989706039, 0.138743341],
    [-0.749825656, 0.490963131],
    [-0.494442463, 0.398857266],
    [-0.392195821, 0.723786414],
    [0.0136043169, 0.62400502],
    [-0.569608867, 0.952345431],
    [-0.820307076, 2.14119387],
    [-1.12221646, 0.264962494],
    [-1.30298138, 0.45855552],
    [-1.1474359, 0.331483483],
    [-0.439318508, 0.554072678],
    [0.624027669, 0.268373847],
    [0.921685517, 0.6666466],
    [1.05621469, 0.525929272],
    [0.439898133, 0.869620681],
    [0.748287082, 1.32844448],
    [0.29753086, -0.313257843],
    [-0.311633259, 0.884118855],
    [-0.0314103812, -0.0250004921],
    [0.0808867738, 0.502049923],
    [-0.333047152, 0.478170604],
    [-0.373037815, 0.548102915],
    [0.759347022, 0.0884262249],
    [0.135215402, 0.0278751217],
    [-0.167387426, -0.241619915],
    [0.348640144, -0.30984652],
    [0.65066433, 0.800541222],
    [0.763366759, 0.926760435],
    [0.240089968, 0.669205129],
    [-0.0693007261, 0.87473768],
    [-0.763036907, 2.70576906],
    [0.189895764, 1.6908983],
    [0.643588424, 0.308457017],
    [0.490691364, 7.51915503],
    [0.762375236, 5.13378286],
    [1.07677722, 4.36623383],
    [0.702512801, 8.0027113],
    [0.886736631, 1.81797016],
    [0.596458077, 0.443204522],
    [0.598583877, 0.246200189],
    [0.348647773, 1.07515335],
    [-0.12809512, 0.584774673],
    [0.00965853501, 1.24998379],
    [0.158049017, -0.0821402818],
    [-0.0239928868, 0.00825996324],
    [0.0838257372, 0.305045694],
    [0.429200113, -0.187038645],
    [-0.0522940345, -0.204095304],
    [-0.102888428, -0.233944431],
    [-0.578458846, -0.0420571417],
    [0.49818784, -0.16827634],
    [0.19887577, 1.40008235],
    [-0.47564128, 0.097807385],
    [-0.271721601, -0.23906143],
    [-0.347726613, 0.141301811],
    [-0.478626102, -0.246736929],
    [-0.484080911, -0.251853913],
    [-0.0266489182, 0.205264241],
    [1.13144481, 0.33063066],
    [2.15099216, -0.238208592],
    [1.53490245, -0.2910842],
    [1.51245129, -0.329461664],
    [1.53982449, -0.320933342],
    [0.296954811, 0.644472957],
    [0.0769766718, -0.216034949],
    [0.0856686383, -0.199831143],
    [-0.652536809, 0.936994433],
    [-0.540851414, 0.881560326],
    [-0.8362661, -0.0156193357],
    [-0.721328259, 0.000584468537],
    [0.0714250207, 0.148977309],
    [-0.231063113, 0.880707562],
    [-1.2463026, 0.229996428],
    [-1.16220212, 0.318690985],
    [-1.58719099, 0.328072101],
    [-0.976851642, 0.414208174],
    [-1.27297235, 0.0500487611],
    [0.214620724, -0.126487553],
    [-0.439219147, -0.000268346485],
    [-1.2898798, -0.0736119375],
    [-1.34701729, -0.0505854525],
    [-1.53782248, 0.797982812],
    [-1.62647557, 0.780073285],
    [-1.25181103, 1.45722222],
    [-1.24742162, 2.78508234],
    [-0.551457644, 0.0713695809],
    [-0.593612432, 0.707582593],
    [-0.952274561, 1.37449741],
    [-1.61850226, 0.383506268],
    [-1.67888224, 0.100365862],
    [-1.6473949, 0.110599868],
    [-0.893961906, -0.0599666089],
    [0.39393267, -0.207506642],
    [1.03876197, -0.222857609],
    [1.07737362, -0.279144555],
    [1.28084981, -0.262087911],
    [1.2136209, -0.323491812],
    [1.2136209, -0.323491812],
  ],
];

const loadModel = async () => {
  try {
    // console.log(tensor);

    const model = await tf.loadLayersModel(process.env.MODEL);

    console.log("Model loaded successfully");

    // pred.data().then((data) => {
    //   console.log(data);
    // });

    return model;
  } catch (error) {
    console.error("Error loading model:", error);
  }
};

exports.predict = catchAsync(async (req, res) => {
  const model = await loadModel();
  const tensor = tf.tensor3d(array);

  const result = await model.predict(tensor);

  const pred = result.dataSync();
  res.status(200).json({ status: "success", pred });
});
